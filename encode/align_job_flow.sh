#!/usr/bin/env bash
set -e

/opt/hadoop/bin/hadoop jar /opt/hadoop/share/hadoop/tools/lib/hadoop-streaming-2.7.3.jar -D"mapreduce.job.reduces=7" -D"stream.num.map.output.key.fields=1" -D"mapreduce.partition.keypartitioner.options=-k1,1" -D"elephantbird.use.combine.input.format=true" -D"elephantbird.check.is.splitable=true" -D"elephantbird.lzo.output.index=true" -D"elephantbird.combine.split.size=536870912" -D"elephantbird.combined.split.count=7" -D"mapreduce.reduce.memory.mb=1" -D"mapreduce.reduce.java.opts=-Xmx1m" -D"io.compression.codecs=org.apache.hadoop.io.compress.DefaultCodec,com.hadoop.compression.lzo.LzoCodec,com.hadoop.compression.lzo.LzopCodec,org.apache.hadoop.io.compress.GzipCodec,org.apache.hadoop.io.compress.BZip2Codec" -D"io.compression.codec.lzo.class=com.hadoop.compression.lzo.LzoCodec" -libjars /local/libraries/hadoop-lzo-release-0.4.20/target/hadoop-lzo-0.4.20.jar,/local/jar/relevant-elephant.jar,/local/jar/custom-output-formats.jar -partitioner org.apache.hadoop.mapred.lib.KeyFieldBasedPartitioner -input hdfs://test/log/preprocess/push -output hdfs://test/log/align_reads -mapper "cut -f2-" -reducer "/local/raildotbio/pypy-2.5-linux_x86_64-portable/bin/pypy /local/rail/src/rna/steps/align_reads.py --bowtie-idx=/local/index/dm3/genome --bowtie2-idx=/local/index/dm3/genome --bowtie2-exe=/local/raildotbio/bowtie2-2.2.7/bowtie2 --exon-differentials --partition-length=5000 --min-exon-size=9 --search-filter=1 --manifest=hdfs://test/log/MANIFEST --max-readlet-size=25 --readlet-interval=4 --capping-multiplier=1.1 --gzip-level 3 --index-count 200 --tie-margin 0     --output-bam-by-chr  --no-polyA -- " -outputformat edu.jhu.cs.MultipleIndexedLzoTextOutputFormat -inputformat com.twitter.elephantbird.mapred.input.DeprecatedCombineLzoTextInputFormat
/opt/hadoop/bin/hadoop jar /opt/hadoop/share/hadoop/tools/lib/hadoop-streaming-2.7.3.jar -D"mapreduce.job.reduces=7" -D"stream.num.map.output.key.fields=1" -D"mapreduce.partition.keypartitioner.options=-k1,1" -D"elephantbird.use.combine.input.format=true" -D"elephantbird.check.is.splitable=true" -D"elephantbird.lzo.output.index=true" -D"elephantbird.combine.split.size=536870912" -D"elephantbird.combined.split.count=7" -D"io.compression.codecs=org.apache.hadoop.io.compress.DefaultCodec,com.hadoop.compression.lzo.LzoCodec,com.hadoop.compression.lzo.LzopCodec,org.apache.hadoop.io.compress.GzipCodec,org.apache.hadoop.io.compress.BZip2Codec" -D"io.compression.codec.lzo.class=com.hadoop.compression.lzo.LzoCodec" -libjars /local/libraries/hadoop-lzo-release-0.4.20/target/hadoop-lzo-0.4.20.jar,/local/jar/relevant-elephant.jar,/local/jar/custom-output-formats.jar -partitioner org.apache.hadoop.mapred.lib.KeyFieldBasedPartitioner -input hdfs://test/log/align_reads/readletized -output hdfs://test/log/align_readlets -mapper "cut -f2-" -reducer "/local/raildotbio/pypy-2.5-linux_x86_64-portable/bin/pypy /local/rail/src/rna/steps/align_readlets.py --bowtie-idx=/local/index/dm3/genome --bowtie-exe=/local/raildotbio/bowtie-1.1.2/bowtie   --gzip-level=3  -- -t --sam-nohead --startverbose -v 0 -a -m 30" -outputformat edu.jhu.cs.IndexedLzoTextOutputFormat -inputformat com.twitter.elephantbird.mapred.input.DeprecatedCombineLzoTextInputFormat
/opt/hadoop/bin/hadoop jar /opt/hadoop/share/hadoop/tools/lib/hadoop-streaming-2.7.3.jar -D"mapreduce.job.reduces=7" -D"stream.num.map.output.key.fields=1" -D"mapreduce.partition.keypartitioner.options=-k1,1" -D"elephantbird.use.combine.input.format=true" -D"elephantbird.check.is.splitable=false" -D"elephantbird.lzo.output.index=true" -D"elephantbird.combine.split.size=536870912" -D"elephantbird.combined.split.count=7" -D"io.compression.codecs=org.apache.hadoop.io.compress.DefaultCodec,com.hadoop.compression.lzo.LzoCodec,com.hadoop.compression.lzo.LzopCodec,org.apache.hadoop.io.compress.GzipCodec,org.apache.hadoop.io.compress.BZip2Codec" -D"io.compression.codec.lzo.class=com.hadoop.compression.lzo.LzoCodec" -libjars /local/libraries/hadoop-lzo-release-0.4.20/target/hadoop-lzo-0.4.20.jar,/local/jar/relevant-elephant.jar,/local/jar/custom-output-formats.jar -partitioner org.apache.hadoop.mapred.lib.KeyFieldBasedPartitioner -input hdfs://test/log/align_readlets -output hdfs://test/log/junction_search -mapper "cut -f2-" -reducer "/local/raildotbio/pypy-2.5-linux_x86_64-portable/bin/pypy /local/rail/src/rna/steps/junction_search.py --bowtie-idx=/local/index/dm3/genome --partition-length=5000 --max-intron-size=500000 --min-intron-size=10 --min-exon-size=9 --search-window-size=1000   --motif-radius=5 " -outputformat edu.jhu.cs.IndexedLzoTextOutputFormat -inputformat com.twitter.elephantbird.mapred.input.DeprecatedCombineLzoTextInputFormat
/opt/hadoop/bin/hadoop fs -rm -r -skipTrash hdfs://test/log/align_readlets
/opt/hadoop/bin/hadoop jar /opt/hadoop/share/hadoop/tools/lib/hadoop-streaming-2.7.3.jar -D"mapreduce.job.reduces=7" -D"stream.num.map.output.key.fields=3" -D"mapreduce.partition.keypartitioner.options=-k1,3" -D"elephantbird.use.combine.input.format=true" -D"elephantbird.check.is.splitable=false" -D"elephantbird.lzo.output.index=true" -D"elephantbird.combine.split.size=268435456" -D"elephantbird.combined.split.count=7" -D"io.compression.codecs=org.apache.hadoop.io.compress.DefaultCodec,com.hadoop.compression.lzo.LzoCodec,com.hadoop.compression.lzo.LzopCodec,org.apache.hadoop.io.compress.GzipCodec,org.apache.hadoop.io.compress.BZip2Codec" -D"io.compression.codec.lzo.class=com.hadoop.compression.lzo.LzoCodec" -libjars /local/libraries/hadoop-lzo-release-0.4.20/target/hadoop-lzo-0.4.20.jar,/local/jar/relevant-elephant.jar,/local/jar/custom-output-formats.jar -partitioner org.apache.hadoop.mapred.lib.KeyFieldBasedPartitioner -input hdfs://test/log/junction_search -output hdfs://test/log/junction_filter -mapper "cut -f2-" -reducer "/local/raildotbio/pypy-2.5-linux_x86_64-portable/bin/pypy /local/rail/src/rna/steps/junction_filter.py --manifest=hdfs://test/log/MANIFEST --sample-fraction=0.05 --coverage-threshold=5 --collect-junctions" -outputformat edu.jhu.cs.MultipleIndexedLzoTextOutputFormat -inputformat com.twitter.elephantbird.mapred.input.DeprecatedCombineLzoTextInputFormat
/opt/hadoop/bin/hadoop fs -rm -r -skipTrash hdfs://test/log/junction_search
/opt/hadoop/bin/hadoop jar /opt/hadoop/share/hadoop/tools/lib/hadoop-streaming-2.7.3.jar -D"mapreduce.job.reduces=7" -D"stream.num.map.output.key.fields=4" -D"mapreduce.partition.keypartitioner.options=-k1,2" -D"mapreduce.job.output.key.comparator.class=org.apache.hadoop.mapred.lib.KeyFieldBasedComparator" -D"mapreduce.partition.keycomparator.options=-k1,2 -k3,4" -D"elephantbird.use.combine.input.format=true" -D"elephantbird.check.is.splitable=false" -D"elephantbird.lzo.output.index=true" -D"elephantbird.combine.split.size=268435456" -D"elephantbird.combined.split.count=7" -D"io.compression.codecs=org.apache.hadoop.io.compress.DefaultCodec,com.hadoop.compression.lzo.LzoCodec,com.hadoop.compression.lzo.LzopCodec,org.apache.hadoop.io.compress.GzipCodec,org.apache.hadoop.io.compress.BZip2Codec" -D"io.compression.codec.lzo.class=com.hadoop.compression.lzo.LzoCodec" -libjars /local/libraries/hadoop-lzo-release-0.4.20/target/hadoop-lzo-0.4.20.jar,/local/jar/relevant-elephant.jar,/local/jar/custom-output-formats.jar -partitioner org.apache.hadoop.mapred.lib.KeyFieldBasedPartitioner -input hdfs://test/log/junction_filter/filter -output hdfs://test/log/junction_config -mapper "cut -f2-" -reducer "/local/raildotbio/pypy-2.5-linux_x86_64-portable/bin/pypy /local/rail/src/rna/steps/junction_config.py --readlet-size=35 --min-overlap-exon-size=9 " -outputformat edu.jhu.cs.IndexedLzoTextOutputFormat -inputformat com.twitter.elephantbird.mapred.input.DeprecatedCombineLzoTextInputFormat
/opt/hadoop/bin/hadoop jar /opt/hadoop/share/hadoop/tools/lib/hadoop-streaming-2.7.3.jar -D"mapreduce.job.reduces=7" -D"stream.num.map.output.key.fields=3" -D"mapreduce.partition.keypartitioner.options=-k1,3" -D"elephantbird.use.combine.input.format=true" -D"elephantbird.check.is.splitable=false" -D"elephantbird.lzo.output.index=true" -D"elephantbird.combine.split.size=268435456" -D"elephantbird.combined.split.count=7" -D"io.compression.codecs=org.apache.hadoop.io.compress.DefaultCodec,com.hadoop.compression.lzo.LzoCodec,com.hadoop.compression.lzo.LzopCodec,org.apache.hadoop.io.compress.GzipCodec,org.apache.hadoop.io.compress.BZip2Codec" -D"io.compression.codec.lzo.class=com.hadoop.compression.lzo.LzoCodec" -libjars /local/libraries/hadoop-lzo-release-0.4.20/target/hadoop-lzo-0.4.20.jar,/local/jar/relevant-elephant.jar,/local/jar/custom-output-formats.jar -partitioner org.apache.hadoop.mapred.lib.KeyFieldBasedPartitioner -input hdfs://test/log/junction_config -output hdfs://test/log/junction_fasta -mapper "cut -f2-" -reducer "/local/raildotbio/pypy-2.5-linux_x86_64-portable/bin/pypy /local/rail/src/rna/steps/junction_fasta.py --bowtie-idx=/local/index/dm3/genome " -outputformat edu.jhu.cs.IndexedLzoTextOutputFormat -inputformat com.twitter.elephantbird.mapred.input.DeprecatedCombineLzoTextInputFormat
/opt/hadoop/bin/hadoop fs -rm -r -skipTrash hdfs://test/log/junction_config
/opt/hadoop/bin/hadoop jar /opt/hadoop/share/hadoop/tools/lib/hadoop-streaming-2.7.3.jar -D"mapreduce.job.reduces=1" -D"stream.num.map.output.key.fields=2" -D"mapreduce.partition.keypartitioner.options=-k1,1" -D"mapreduce.job.output.key.comparator.class=org.apache.hadoop.mapred.lib.KeyFieldBasedComparator" -D"mapreduce.partition.keycomparator.options=-k1,1 -k2,2" -D"elephantbird.use.combine.input.format=true" -D"elephantbird.check.is.splitable=false" -D"elephantbird.lzo.output.index=true" -D"elephantbird.combine.split.size=268435456" -D"elephantbird.combined.split.count=7" -D"io.compression.codecs=org.apache.hadoop.io.compress.DefaultCodec,com.hadoop.compression.lzo.LzoCodec,com.hadoop.compression.lzo.LzopCodec,org.apache.hadoop.io.compress.GzipCodec,org.apache.hadoop.io.compress.BZip2Codec" -D"io.compression.codec.lzo.class=com.hadoop.compression.lzo.LzoCodec" -libjars /local/libraries/hadoop-lzo-release-0.4.20/target/hadoop-lzo-0.4.20.jar,/local/jar/relevant-elephant.jar,/local/jar/custom-output-formats.jar -partitioner org.apache.hadoop.mapred.lib.KeyFieldBasedPartitioner -input hdfs://test/log/junction_fasta,hdfs://test/log/align_reads/dummy -output hdfs://test/log/junction_index -mapper "cut -f2-" -reducer "/local/raildotbio/pypy-2.5-linux_x86_64-portable/bin/pypy /local/rail/src/rna/steps/junction_index.py --bowtie2-build-exe=/local/raildotbio/bowtie2-2.2.7/bowtie2-build --out=hdfs://test/rail-rna_out/cross_sample_results --basename isofrags  " -outputformat edu.jhu.cs.IndexedLzoTextOutputFormat -inputformat com.twitter.elephantbird.mapred.input.DeprecatedCombineLzoTextInputFormat
/opt/hadoop/bin/hadoop fs -rm -r -skipTrash hdfs://test/log/junction_fasta
/opt/hadoop/bin/hadoop jar /opt/hadoop/share/hadoop/tools/lib/hadoop-streaming-2.7.3.jar -D"mapreduce.job.reduces=7" -D"stream.num.map.output.key.fields=1" -D"mapreduce.partition.keypartitioner.options=-k1,1" -D"elephantbird.use.combine.input.format=true" -D"elephantbird.check.is.splitable=false" -D"elephantbird.lzo.output.index=true" -D"elephantbird.combine.split.size=536870912" -D"elephantbird.combined.split.count=7" -D"io.compression.codecs=org.apache.hadoop.io.compress.DefaultCodec,com.hadoop.compression.lzo.LzoCodec,com.hadoop.compression.lzo.LzopCodec,org.apache.hadoop.io.compress.GzipCodec,org.apache.hadoop.io.compress.BZip2Codec" -D"io.compression.codec.lzo.class=com.hadoop.compression.lzo.LzoCodec" -libjars /local/libraries/hadoop-lzo-release-0.4.20/target/hadoop-lzo-0.4.20.jar,/local/jar/relevant-elephant.jar,/local/jar/custom-output-formats.jar -archives hdfs://test/rail-rna_out/cross_sample_results/isofrags.tar.gz#isofrags -partitioner org.apache.hadoop.mapred.lib.KeyFieldBasedPartitioner -input hdfs://test/log/align_reads/unique -output hdfs://test/log/cojunction_enum -mapper "cut -f2-" -reducer "/local/raildotbio/pypy-2.5-linux_x86_64-portable/bin/pypy /local/rail/src/rna/steps/cojunction_enum.py --bowtie2-idx=isofrags/isofrags --gzip-level 3 --bowtie2-exe=/local/raildotbio/bowtie2-2.2.7/bowtie2   --intermediate-dir hdfs://test/log --max-refs 300  -- -k 30" -outputformat edu.jhu.cs.IndexedLzoTextOutputFormat -inputformat com.twitter.elephantbird.mapred.input.DeprecatedCombineLzoTextInputFormat
/opt/hadoop/bin/hadoop jar /opt/hadoop/share/hadoop/tools/lib/hadoop-streaming-2.7.3.jar -D"mapreduce.job.reduces=7" -D"stream.num.map.output.key.fields=3" -D"mapreduce.partition.keypartitioner.options=-k1,3" -D"elephantbird.use.combine.input.format=true" -D"elephantbird.check.is.splitable=false" -D"elephantbird.lzo.output.index=true" -D"elephantbird.combine.split.size=268435456" -D"elephantbird.combined.split.count=7" -D"io.compression.codecs=org.apache.hadoop.io.compress.DefaultCodec,com.hadoop.compression.lzo.LzoCodec,com.hadoop.compression.lzo.LzopCodec,org.apache.hadoop.io.compress.GzipCodec,org.apache.hadoop.io.compress.BZip2Codec" -D"io.compression.codec.lzo.class=com.hadoop.compression.lzo.LzoCodec" -libjars /local/libraries/hadoop-lzo-release-0.4.20/target/hadoop-lzo-0.4.20.jar,/local/jar/relevant-elephant.jar,/local/jar/custom-output-formats.jar -partitioner org.apache.hadoop.mapred.lib.KeyFieldBasedPartitioner -input hdfs://test/log/cojunction_enum -output hdfs://test/log/cojunction_fasta -mapper "cut -f2-" -reducer "/local/raildotbio/pypy-2.5-linux_x86_64-portable/bin/pypy /local/rail/src/rna/steps/cojunction_fasta.py --bowtie-idx=/local/index/dm3/genome --index-count 200 " -outputformat edu.jhu.cs.IndexedLzoTextOutputFormat -inputformat com.twitter.elephantbird.mapred.input.DeprecatedCombineLzoTextInputFormat
/opt/hadoop/bin/hadoop fs -rm -r -skipTrash hdfs://test/log/cojunction_enum
/opt/hadoop/bin/hadoop jar /opt/hadoop/share/hadoop/tools/lib/hadoop-streaming-2.7.3.jar -D"mapreduce.job.reduces=7" -D"stream.num.map.output.key.fields=3" -D"mapreduce.partition.keypartitioner.options=-k1,1" -D"mapreduce.job.output.key.comparator.class=org.apache.hadoop.mapred.lib.KeyFieldBasedComparator" -D"mapreduce.partition.keycomparator.options=-k1,1 -k2,3" -D"elephantbird.use.combine.input.format=true" -D"elephantbird.check.is.splitable=true" -D"elephantbird.lzo.output.index=true" -D"elephantbird.combine.split.size=536870912" -D"elephantbird.combined.split.count=7" -D"io.compression.codecs=org.apache.hadoop.io.compress.DefaultCodec,com.hadoop.compression.lzo.LzoCodec,com.hadoop.compression.lzo.LzopCodec,org.apache.hadoop.io.compress.GzipCodec,org.apache.hadoop.io.compress.BZip2Codec" -D"io.compression.codec.lzo.class=com.hadoop.compression.lzo.LzoCodec" -libjars /local/libraries/hadoop-lzo-release-0.4.20/target/hadoop-lzo-0.4.20.jar,/local/jar/relevant-elephant.jar,/local/jar/custom-output-formats.jar,/local/jar/mod-partitioner.jar -partitioner edu.jhu.cs.ModPartitioner -input hdfs://test/log/align_reads/unmapped,hdfs://test/log/cojunction_fasta -output hdfs://test/log/realign_reads -mapper "cut -f2-" -reducer "/local/raildotbio/pypy-2.5-linux_x86_64-portable/bin/pypy /local/rail/src/rna/steps/realign_reads.py --bowtie2-exe=/local/raildotbio/bowtie2-2.2.7/bowtie2 --bowtie2-build-exe=/local/raildotbio/bowtie2-2.2.7/bowtie2-build --gzip-level 3 --count-multiplier 15 --tie-margin 0    -- " -outputformat edu.jhu.cs.IndexedLzoTextOutputFormat -inputformat com.twitter.elephantbird.mapred.input.DeprecatedCombineLzoTextInputFormat
/opt/hadoop/bin/hadoop fs -rm -r -skipTrash hdfs://test/log/cojunction_fasta
/opt/hadoop/bin/hadoop jar /opt/hadoop/share/hadoop/tools/lib/hadoop-streaming-2.7.3.jar -D"mapreduce.job.reduces=7" -D"stream.num.map.output.key.fields=1" -D"mapreduce.partition.keypartitioner.options=-k1,1" -D"elephantbird.use.combine.input.format=true" -D"elephantbird.check.is.splitable=false" -D"elephantbird.lzo.output.index=true" -D"elephantbird.combine.split.size=536870912" -D"elephantbird.combined.split.count=7" -D"mapreduce.reduce.memory.mb=2" -D"mapreduce.reduce.java.opts=-Xmx1m" -D"io.compression.codecs=org.apache.hadoop.io.compress.DefaultCodec,com.hadoop.compression.lzo.LzoCodec,com.hadoop.compression.lzo.LzopCodec,org.apache.hadoop.io.compress.GzipCodec,org.apache.hadoop.io.compress.BZip2Codec" -D"io.compression.codec.lzo.class=com.hadoop.compression.lzo.LzoCodec" -libjars /local/libraries/hadoop-lzo-release-0.4.20/target/hadoop-lzo-0.4.20.jar,/local/jar/relevant-elephant.jar,/local/jar/custom-output-formats.jar -partitioner org.apache.hadoop.mapred.lib.KeyFieldBasedPartitioner -input hdfs://test/log/align_reads/postponed_sam,hdfs://test/log/realign_reads -output hdfs://test/log/compare_alignments -mapper "cut -f2-" -reducer "/local/raildotbio/pypy-2.5-linux_x86_64-portable/bin/pypy /local/rail/src/rna/steps/compare_alignments.py --bowtie-idx=/local/index/dm3/genome --partition-length=5000 --exon-differentials --tie-margin 0 --manifest=hdfs://test/log/MANIFEST   --output-bam-by-chr -- " -outputformat edu.jhu.cs.MultipleIndexedLzoTextOutputFormat -inputformat com.twitter.elephantbird.mapred.input.DeprecatedCombineLzoTextInputFormat
/opt/hadoop/bin/hadoop fs -rm -r -skipTrash hdfs://test/log/realign_reads
/opt/hadoop/bin/hadoop jar /opt/hadoop/share/hadoop/tools/lib/hadoop-streaming-2.7.3.jar -D"mapreduce.job.reduces=7" -D"stream.num.map.output.key.fields=7" -D"mapreduce.partition.keypartitioner.options=-k1,6" -D"mapreduce.job.output.key.comparator.class=org.apache.hadoop.mapred.lib.KeyFieldBasedComparator" -D"mapreduce.partition.keycomparator.options=-k1,6 -k7,7" -D"elephantbird.use.combine.input.format=true" -D"elephantbird.check.is.splitable=false" -D"elephantbird.lzo.output.index=true" -D"elephantbird.combine.split.size=268435456" -D"elephantbird.combined.split.count=7" -D"io.compression.codecs=org.apache.hadoop.io.compress.DefaultCodec,com.hadoop.compression.lzo.LzoCodec,com.hadoop.compression.lzo.LzopCodec,org.apache.hadoop.io.compress.GzipCodec,org.apache.hadoop.io.compress.BZip2Codec" -D"io.compression.codec.lzo.class=com.hadoop.compression.lzo.LzoCodec" -libjars /local/libraries/hadoop-lzo-release-0.4.20/target/hadoop-lzo-0.4.20.jar,/local/jar/relevant-elephant.jar,/local/jar/custom-output-formats.jar -partitioner org.apache.hadoop.mapred.lib.KeyFieldBasedPartitioner -input hdfs://test/log/compare_alignments/junction_bed,hdfs://test/log/compare_alignments/sam_junction_ties -output hdfs://test/log/junction_coverage -mapper "cut -f2-" -reducer "/local/raildotbio/pypy-2.5-linux_x86_64-portable/bin/pypy /local/rail/src/rna/steps/junction_coverage.py --bowtie-idx /local/index/dm3/genome" -outputformat edu.jhu.cs.IndexedLzoTextOutputFormat -inputformat com.twitter.elephantbird.mapred.input.DeprecatedCombineLzoTextInputFormat
/opt/hadoop/bin/hadoop jar /opt/hadoop/share/hadoop/tools/lib/hadoop-streaming-2.7.3.jar -D"mapreduce.job.reduces=7" -D"stream.num.map.output.key.fields=1" -D"mapreduce.partition.keypartitioner.options=-k1,1" -D"elephantbird.use.combine.input.format=true" -D"elephantbird.check.is.splitable=false" -D"elephantbird.lzo.output.index=true" -D"elephantbird.combine.split.size=268435456" -D"elephantbird.combined.split.count=7" -D"io.compression.codecs=org.apache.hadoop.io.compress.DefaultCodec,com.hadoop.compression.lzo.LzoCodec,com.hadoop.compression.lzo.LzopCodec,org.apache.hadoop.io.compress.GzipCodec,org.apache.hadoop.io.compress.BZip2Codec" -D"io.compression.codec.lzo.class=com.hadoop.compression.lzo.LzoCodec" -libjars /local/libraries/hadoop-lzo-release-0.4.20/target/hadoop-lzo-0.4.20.jar,/local/jar/relevant-elephant.jar,/local/jar/custom-output-formats.jar -partitioner org.apache.hadoop.mapred.lib.KeyFieldBasedPartitioner -input hdfs://test/log/junction_coverage,hdfs://test/log/compare_alignments/sam_clip_ties -output hdfs://test/log/break_ties -mapper "cut -f2-" -reducer "/local/raildotbio/pypy-2.5-linux_x86_64-portable/bin/pypy /local/rail/src/rna/steps/break_ties.py --exon-differentials --bowtie-idx /local/index/dm3/genome --partition-length 5000 --manifest hdfs://test/log/MANIFEST --tie-margin 0  --output-bam-by-chr -- " -outputformat edu.jhu.cs.MultipleIndexedLzoTextOutputFormat -inputformat com.twitter.elephantbird.mapred.input.DeprecatedCombineLzoTextInputFormat
/opt/hadoop/bin/hadoop fs -rm -r -skipTrash hdfs://test/log/junction_coverage
/opt/hadoop/bin/hadoop jar /opt/hadoop/share/hadoop/tools/lib/hadoop-streaming-2.7.3.jar -D"mapreduce.job.reduces=7" -D"stream.num.map.output.key.fields=3" -D"mapreduce.partition.keypartitioner.options=-k1,1" -D"mapreduce.job.output.key.comparator.class=org.apache.hadoop.mapred.lib.KeyFieldBasedComparator" -D"mapreduce.partition.keycomparator.options=-k1,1 -k2,3" -D"mapreduce.reduce.shuffle.input.buffer.percent=0.4" -D"mapreduce.reduce.shuffle.merge.percent=0.4" -D"elephantbird.use.combine.input.format=true" -D"elephantbird.check.is.splitable=false" -D"elephantbird.lzo.output.index=true" -D"elephantbird.combine.split.size=268435456" -D"elephantbird.combined.split.count=7" -D"io.compression.codecs=org.apache.hadoop.io.compress.DefaultCodec,com.hadoop.compression.lzo.LzoCodec,com.hadoop.compression.lzo.LzopCodec,org.apache.hadoop.io.compress.GzipCodec,org.apache.hadoop.io.compress.BZip2Codec" -D"io.compression.codec.lzo.class=com.hadoop.compression.lzo.LzoCodec" -libjars /local/libraries/hadoop-lzo-release-0.4.20/target/hadoop-lzo-0.4.20.jar,/local/jar/relevant-elephant.jar,/local/jar/custom-output-formats.jar,/local/jar/mod-partitioner.jar -partitioner edu.jhu.cs.ModPartitioner -input hdfs://test/log/compare_alignments/sam,hdfs://test/log/break_ties/sam,hdfs://test/log/align_reads/sam -output hdfs://test/log/bam -mapper "cut -f2-" -reducer "/local/raildotbio/pypy-2.5-linux_x86_64-portable/bin/pypy /local/rail/src/rna/steps/bam.py --out=hdfs://test/rail-rna_out/alignments --bowtie-idx=/local/index/dm3/genome --samtools-exe=/local/raildotbio/samtools-1.2/samtools --bam-basename=alignments --manifest=hdfs://test/log/MANIFEST  --output-by-chromosome   --suppress-bam --tie-margin 0" -outputformat edu.jhu.cs.MultipleIndexedLzoTextOutputFormat -inputformat com.twitter.elephantbird.mapred.input.DeprecatedCombineLzoTextInputFormat
/opt/hadoop/bin/hadoop jar /opt/hadoop/share/hadoop/tools/lib/hadoop-streaming-2.7.3.jar -D"mapreduce.job.reduces=1" -D"stream.num.map.output.key.fields=2" -D"mapreduce.partition.keypartitioner.options=-k1,1" -D"mapreduce.job.output.key.comparator.class=org.apache.hadoop.mapred.lib.KeyFieldBasedComparator" -D"mapreduce.partition.keycomparator.options=-k1,1 -k2,2n" -D"elephantbird.use.combine.input.format=true" -D"elephantbird.check.is.splitable=false" -D"elephantbird.lzo.output.index=true" -D"elephantbird.combine.split.size=268435456" -D"elephantbird.combined.split.count=7" -D"io.compression.codecs=org.apache.hadoop.io.compress.DefaultCodec,com.hadoop.compression.lzo.LzoCodec,com.hadoop.compression.lzo.LzopCodec,org.apache.hadoop.io.compress.GzipCodec,org.apache.hadoop.io.compress.BZip2Codec" -D"io.compression.codec.lzo.class=com.hadoop.compression.lzo.LzoCodec" -libjars /local/libraries/hadoop-lzo-release-0.4.20/target/hadoop-lzo-0.4.20.jar,/local/jar/relevant-elephant.jar,/local/jar/custom-output-formats.jar -partitioner org.apache.hadoop.mapred.lib.KeyFieldBasedPartitioner -input hdfs://test/log/bam/counts -output hdfs://test/log/read_counts -mapper "cut -f2-" -reducer "/local/raildotbio/pypy-2.5-linux_x86_64-portable/bin/pypy /local/rail/src/rna/steps/collect_read_stats.py --bowtie-idx=/local/index/dm3/genome --out=hdfs://test/rail-rna_out/cross_sample_results --manifest=hdfs://test/log/MANIFEST --gzip-level=3 --tsv-basename=  " -outputformat edu.jhu.cs.IndexedLzoTextOutputFormat -inputformat com.twitter.elephantbird.mapred.input.DeprecatedCombineLzoTextInputFormat
/opt/hadoop/bin/hadoop jar /opt/hadoop/share/hadoop/tools/lib/hadoop-streaming-2.7.3.jar -D"mapreduce.job.reduces=7" -D"stream.num.map.output.key.fields=4" -D"mapreduce.partition.keypartitioner.options=-k1,4" -D"elephantbird.use.combine.input.format=true" -D"elephantbird.check.is.splitable=false" -D"elephantbird.lzo.output.index=true" -D"elephantbird.combine.split.size=268435456" -D"elephantbird.combined.split.count=7" -D"io.compression.codecs=org.apache.hadoop.io.compress.DefaultCodec,com.hadoop.compression.lzo.LzoCodec,com.hadoop.compression.lzo.LzopCodec,org.apache.hadoop.io.compress.GzipCodec,org.apache.hadoop.io.compress.BZip2Codec" -D"io.compression.codec.lzo.class=com.hadoop.compression.lzo.LzoCodec" -libjars /local/libraries/hadoop-lzo-release-0.4.20/target/hadoop-lzo-0.4.20.jar,/local/jar/relevant-elephant.jar,/local/jar/custom-output-formats.jar -partitioner org.apache.hadoop.mapred.lib.KeyFieldBasedPartitioner -input hdfs://test/log/align_reads/exon_diff,hdfs://test/log/compare_alignments/exon_diff,hdfs://test/log/break_ties/exon_diff -output hdfs://test/log/collapse -mapper "cut -f2-" -reducer "/local/raildotbio/pypy-2.5-linux_x86_64-portable/bin/pypy /local/rail/src/rna/steps/sum.py " -outputformat edu.jhu.cs.IndexedLzoTextOutputFormat -inputformat com.twitter.elephantbird.mapred.input.DeprecatedCombineLzoTextInputFormat
/opt/hadoop/bin/hadoop jar /opt/hadoop/share/hadoop/tools/lib/hadoop-streaming-2.7.3.jar -D"mapreduce.job.reduces=7" -D"stream.num.map.output.key.fields=3" -D"mapreduce.partition.keypartitioner.options=-k1,1" -D"mapreduce.job.output.key.comparator.class=org.apache.hadoop.mapred.lib.KeyFieldBasedComparator" -D"mapreduce.partition.keycomparator.options=-k1,1 -k2,3" -D"elephantbird.use.combine.input.format=true" -D"elephantbird.check.is.splitable=false" -D"elephantbird.lzo.output.index=true" -D"elephantbird.combine.split.size=268435456" -D"elephantbird.combined.split.count=7" -D"io.compression.codecs=org.apache.hadoop.io.compress.DefaultCodec,com.hadoop.compression.lzo.LzoCodec,com.hadoop.compression.lzo.LzopCodec,org.apache.hadoop.io.compress.GzipCodec,org.apache.hadoop.io.compress.BZip2Codec" -D"io.compression.codec.lzo.class=com.hadoop.compression.lzo.LzoCodec" -libjars /local/libraries/hadoop-lzo-release-0.4.20/target/hadoop-lzo-0.4.20.jar,/local/jar/relevant-elephant.jar,/local/jar/custom-output-formats.jar -files hdfs://test/rail-rna_out/cross_sample_results/counts.tsv.gz#counts.tsv.gz -partitioner org.apache.hadoop.mapred.lib.KeyFieldBasedPartitioner -input hdfs://test/log/collapse -output hdfs://test/log/precoverage -mapper "cut -f2-" -reducer "/local/raildotbio/pypy-2.5-linux_x86_64-portable/bin/pypy /local/rail/src/rna/steps/coverage_pre.py --bowtie-idx=/local/index/dm3/genome --library-size 40 --read-counts counts.tsv.gz --partition-stats --manifest=hdfs://test/log/MANIFEST --output-ave-bigwig-by-chr" -outputformat edu.jhu.cs.MultipleIndexedLzoTextOutputFormat -inputformat com.twitter.elephantbird.mapred.input.DeprecatedCombineLzoTextInputFormat
/opt/hadoop/bin/hadoop fs -rm -r -skipTrash hdfs://test/log/collapse
/opt/hadoop/bin/hadoop jar /opt/hadoop/share/hadoop/tools/lib/hadoop-streaming-2.7.3.jar -D"mapreduce.job.reduces=7" -D"stream.num.map.output.key.fields=3" -D"mapreduce.partition.keypartitioner.options=-k1,1" -D"mapreduce.job.output.key.comparator.class=org.apache.hadoop.mapred.lib.KeyFieldBasedComparator" -D"mapreduce.partition.keycomparator.options=-k1,1 -k2,3" -D"elephantbird.use.combine.input.format=true" -D"elephantbird.check.is.splitable=false" -D"elephantbird.lzo.output.index=true" -D"elephantbird.combine.split.size=268435456" -D"elephantbird.combined.split.count=7" -D"io.compression.codecs=org.apache.hadoop.io.compress.DefaultCodec,com.hadoop.compression.lzo.LzoCodec,com.hadoop.compression.lzo.LzopCodec,org.apache.hadoop.io.compress.GzipCodec,org.apache.hadoop.io.compress.BZip2Codec" -D"io.compression.codec.lzo.class=com.hadoop.compression.lzo.LzoCodec" -libjars /local/libraries/hadoop-lzo-release-0.4.20/target/hadoop-lzo-0.4.20.jar,/local/jar/relevant-elephant.jar,/local/jar/custom-output-formats.jar,/local/jar/mod-partitioner.jar -partitioner edu.jhu.cs.ModPartitioner -input hdfs://test/log/precoverage/coverage -output hdfs://test/log/coverage -mapper "cut -f2-" -reducer "/local/raildotbio/pypy-2.5-linux_x86_64-portable/bin/pypy /local/rail/src/rna/steps/coverage.py --bowtie-idx=/local/index/dm3/genome --percentile=0.75 --out=hdfs://test/rail-rna_out/coverage_bigwigs --bigwig-exe=/local/raildotbio/bedGraphToBigWig --manifest=hdfs://test/log/MANIFEST  " -outputformat edu.jhu.cs.IndexedLzoTextOutputFormat -inputformat com.twitter.elephantbird.mapred.input.DeprecatedCombineLzoTextInputFormat
/opt/hadoop/bin/hadoop jar /opt/hadoop/share/hadoop/tools/lib/hadoop-streaming-2.7.3.jar -D"mapreduce.job.reduces=7" -D"stream.num.map.output.key.fields=6" -D"mapreduce.partition.keypartitioner.options=-k1,5" -D"mapreduce.job.output.key.comparator.class=org.apache.hadoop.mapred.lib.KeyFieldBasedComparator" -D"mapreduce.partition.keycomparator.options=-k1,5 -k6,6n" -D"elephantbird.use.combine.input.format=true" -D"elephantbird.check.is.splitable=false" -D"elephantbird.lzo.output.index=true" -D"elephantbird.combine.split.size=268435456" -D"elephantbird.combined.split.count=7" -D"io.compression.codecs=org.apache.hadoop.io.compress.DefaultCodec,com.hadoop.compression.lzo.LzoCodec,com.hadoop.compression.lzo.LzopCodec,org.apache.hadoop.io.compress.GzipCodec,org.apache.hadoop.io.compress.BZip2Codec" -D"io.compression.codec.lzo.class=com.hadoop.compression.lzo.LzoCodec" -libjars /local/libraries/hadoop-lzo-release-0.4.20/target/hadoop-lzo-0.4.20.jar,/local/jar/relevant-elephant.jar,/local/jar/custom-output-formats.jar -partitioner org.apache.hadoop.mapred.lib.KeyFieldBasedPartitioner -input hdfs://test/log/compare_alignments/indel_bed,hdfs://test/log/break_ties/indel_bed,hdfs://test/log/compare_alignments/junction_bed,hdfs://test/log/break_ties/junction_bed -output hdfs://test/log/prebed -mapper "cut -f2-" -reducer "/local/raildotbio/pypy-2.5-linux_x86_64-portable/bin/pypy /local/rail/src/rna/steps/bed_pre.py --manifest=hdfs://test/log/MANIFEST --sample-fraction=0.05 --coverage-threshold=5  " -outputformat edu.jhu.cs.MultipleIndexedLzoTextOutputFormat -inputformat com.twitter.elephantbird.mapred.input.DeprecatedCombineLzoTextInputFormat
/opt/hadoop/bin/hadoop jar /opt/hadoop/share/hadoop/tools/lib/hadoop-streaming-2.7.3.jar -D"mapreduce.job.reduces=7" -D"stream.num.map.output.key.fields=5" -D"mapreduce.partition.keypartitioner.options=-k1,1" -D"mapreduce.job.output.key.comparator.class=org.apache.hadoop.mapred.lib.KeyFieldBasedComparator" -D"mapreduce.partition.keycomparator.options=-k1,1 -k2,5" -D"elephantbird.use.combine.input.format=true" -D"elephantbird.check.is.splitable=false" -D"elephantbird.lzo.output.index=true" -D"elephantbird.combine.split.size=268435456" -D"elephantbird.combined.split.count=7" -D"io.compression.codecs=org.apache.hadoop.io.compress.DefaultCodec,com.hadoop.compression.lzo.LzoCodec,com.hadoop.compression.lzo.LzopCodec,org.apache.hadoop.io.compress.GzipCodec,org.apache.hadoop.io.compress.BZip2Codec" -D"io.compression.codec.lzo.class=com.hadoop.compression.lzo.LzoCodec" -libjars /local/libraries/hadoop-lzo-release-0.4.20/target/hadoop-lzo-0.4.20.jar,/local/jar/relevant-elephant.jar,/local/jar/custom-output-formats.jar,/local/jar/mod-partitioner.jar -partitioner edu.jhu.cs.ModPartitioner -input hdfs://test/log/coverage,hdfs://test/log/prebed/collect -output hdfs://test/log/tsv -mapper "cut -f2-" -reducer "/local/raildotbio/pypy-2.5-linux_x86_64-portable/bin/pypy /local/rail/src/rna/steps/tsv.py --bowtie-idx=/local/index/dm3/genome --out=hdfs://test/rail-rna_out/cross_sample_results --manifest=hdfs://test/log/MANIFEST --gzip-level=3 --tsv-basename=  " -outputformat edu.jhu.cs.IndexedLzoTextOutputFormat -inputformat com.twitter.elephantbird.mapred.input.DeprecatedCombineLzoTextInputFormat
/opt/hadoop/bin/hadoop fs -rm -r -skipTrash hdfs://test/log/coverage
/opt/hadoop/bin/hadoop jar /opt/hadoop/share/hadoop/tools/lib/hadoop-streaming-2.7.3.jar -D"mapreduce.job.reduces=7" -D"stream.num.map.output.key.fields=5" -D"mapreduce.partition.keypartitioner.options=-k1,2" -D"mapreduce.job.output.key.comparator.class=org.apache.hadoop.mapred.lib.KeyFieldBasedComparator" -D"mapreduce.partition.keycomparator.options=-k1,2 -k3,5" -D"elephantbird.use.combine.input.format=true" -D"elephantbird.check.is.splitable=false" -D"elephantbird.lzo.output.index=true" -D"elephantbird.combine.split.size=268435456" -D"elephantbird.combined.split.count=7" -D"io.compression.codecs=org.apache.hadoop.io.compress.DefaultCodec,com.hadoop.compression.lzo.LzoCodec,com.hadoop.compression.lzo.LzopCodec,org.apache.hadoop.io.compress.GzipCodec,org.apache.hadoop.io.compress.BZip2Codec" -D"io.compression.codec.lzo.class=com.hadoop.compression.lzo.LzoCodec" -libjars /local/libraries/hadoop-lzo-release-0.4.20/target/hadoop-lzo-0.4.20.jar,/local/jar/relevant-elephant.jar,/local/jar/custom-output-formats.jar -partitioner org.apache.hadoop.mapred.lib.KeyFieldBasedPartitioner -input hdfs://test/log/prebed/bed -output hdfs://test/log/bed -mapper "cut -f2-" -reducer "/local/raildotbio/pypy-2.5-linux_x86_64-portable/bin/pypy /local/rail/src/rna/steps/bed.py --bowtie-idx=/local/index/dm3/genome --out=hdfs://test/rail-rna_out/junctions_and_indels --manifest=hdfs://test/log/MANIFEST --bed-basename=  " -outputformat edu.jhu.cs.IndexedLzoTextOutputFormat -inputformat com.twitter.elephantbird.mapred.input.DeprecatedCombineLzoTextInputFormat
